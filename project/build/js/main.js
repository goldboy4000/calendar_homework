var NAMES_OF_MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"];window.onload=function(){function e(e){l.render(a[a.selectedIndex].value,o[o.selectedIndex].value)}function t(){n.disabled=0===a.selectedIndex||0===o.selectedIndex}var n=document.getElementById("show_button");n.addEventListener("click",e),n.disabled=!0;var a=document.getElementById("month_selector");a.addEventListener("change",t),a.appendChild(getOption(-1,"-choose month-"));for(var r=0;r<NAMES_OF_MONTHS.length;r++)a.appendChild(getOption(r,NAMES_OF_MONTHS[r]));var o=document.getElementById("year_selector");o.addEventListener("change",t),o.appendChild(getOption(-1,"-choose year-"));for(var d=(new Date).getFullYear();d>=1900;d--)o.appendChild(getOption(d,d));var l=new Calendar;l.init(),l.render()};var getOption=function(e,t){var n=document.createElement("option");return n.value=e,n.innerHTML=t,n},findChild=function(e,t){for(var n=0;n<e.children.length;n++)if(e.children[n].tagName===t.toUpperCase())return e.children[n];return null},getButton=function(e,t,n){var a=document.createElement("a"),r=document.createElement("span");r.className="icon is-large",r.setAttribute("id",e),a.appendChild(r);var o=document.createElement("i");return o.className=n,o.innerHTML=t,r.appendChild(o),a},getTag=function(e,t,n){var a=document.createElement("span");return a.className=t,a.setAttribute("id",e),a.innerHTML=n,a},getColumn=function(e,t){var n=document.createElement("div");return n.className="column",t&&n.classList.add(t),n.appendChild(e),n};Date.prototype.daysInMonth=function(){return 32-new Date(this.getFullYear(),this.getMonth(),32).getDate()},Date.prototype.fullWeeksInMonth=function(){var e=new Date(this.getFullYear(),this.getMonth(),1).getDay();e=0===e?7:e;var t=e-1+this.daysInMonth();return Number(Math.floor(t/7)+Boolean(t%7))};
function Calendar(){var e=["ПН","ВТ","СР","ЧТ","ПТ","СБ","ВС"],n=[].shift.call(arguments)||(new Date).getMonth(),t=[].shift.call(arguments)||(new Date).getFullYear();this.__defineGetter__("month",function(){return n}),this.__defineGetter__("year",function(){return t});var r=function(){var e=document.createElement("div");return e.className="columns",e.appendChild(getColumn(getButton("previous","","fa fa-arrow-circle-o-left"))),e.appendChild(getColumn(getTag("date","tag is-primary is-large",NAMES_OF_MONTHS[n]+" "+t),"is-three-quarters")),e.appendChild(getColumn(getButton("next","","fa fa-arrow-circle-o-right"))),e},a=function(){var n=document.createElement("thead"),t=document.createElement("tr");n.appendChild(t);for(var r=0;r<e.length;r++){var a=document.createElement("th");a.innerHTML=e[r],t.appendChild(a)}return n},i=function(){for(var e=document.createElement("tbody"),r=new Date(t,n),a=0===r.getDay()?7:r.getDay(),i=r.daysInMonth(),d=1,c=[],l=!0,o=0;o<r.fullWeeksInMonth();o++){c[o]=document.createElement("tr"),e.appendChild(c[o]);for(var u=1;u<=7;u++)column=document.createElement("td"),u<a&&l||d>i?column.innerHTML="&nbsp":(column.setAttribute("id","day"+d),column.innerHTML=d++,l=!1),c[o].appendChild(column)}return e},d=function(){var e=document.createElement("table");return e.className="table is-bordered",e.setAttribute("id","calendar"),e.appendChild(a()),e.appendChild(i()),e};this.init=function(){document.querySelector("#calendar_nav_container").addEventListener("click",calendarNavClickHandler.bind(this)),document.querySelector("#calendar_container").addEventListener("click",calendarClickHandler.bind(this))},this.render=function(){n=[].shift.call(arguments)||n,t=[].shift.call(arguments)||t;var e=document.querySelector("#calendar_nav_container");e.innerHTML="",e.appendChild(r());var a=document.querySelector("#calendar_container");return a.innerHTML="",a.appendChild(d()),this},this.previous=function(){return-1==--n&&(n=11,t--),this},this.next=function(){return 12==++n&&(n=0,t++),this}}function calendarClickHandler(e){var n=e.target;if(("TD"===n.tagName||"LI"===n.tagName)&&"&nbsp;"!==n.innerHTML){"LI"===n.tagName&&(n=n.parentNode.parentNode);var t=showModal("event_window","Event on "+n.id.slice(3)+" "+NAMES_OF_MONTHS[this.month]+" "+this.year),r=function(e){renderTask(this,e.customParam),t.removeEventListener("success",r),t.removeEventListener("cancel",a)}.bind(n),a=function(){t.removeEventListener("success",r),t.removeEventListener("cancel",a)}.bind(n);t.addEventListener("success",r),t.addEventListener("cancel",a)}if("SPAN"===n.tagName){var i=n.parentNode.parentNode;i.removeChild(n.parentNode),i.children.length||i.parentNode.removeChild(i)}}function calendarNavClickHandler(e){for(var n=e.target;"calendar_nav_container"!==n.id;){if("previous"===n.id){this.previous().render();break}if("next"===n.id){this.next().render();break}n=n.parentNode}}function renderTask(e,n){var t,r=findChild(e,"ul");r?t=r:(t=document.createElement("ul"),e.insertBefore(t,e.childNodes[0]));var a=document.createElement("li");a.innerHTML=n,t.appendChild(a);var i=document.createElement("span");i.textContent=" [X] ",a.appendChild(i)}
var showModal=function(e,t){function n(e){var t=e.target;if("success_button"===t.id){this.classList.remove("is-active");var n=document.createEvent("Event");n.initEvent("success",!0,!0),n.customParam=s.value,c.dispatchEvent(n),s.value=""}if("cancel_button"===t.id||"close_button"===t.id){this.classList.remove("is-active"),s.value="";var a=document.createEvent("Event");a.initEvent("cancel",!0,!0),c.dispatchEvent(a)}}function a(e){var t=e.target;i.disabled=!t.value}var c=document.getElementById(e);c.classList.add("is-active"),c.addEventListener("click",n),document.getElementById("title").innerHTML=t;var i=document.getElementById("success_button");i.disabled=!0;var s=document.getElementById("event_text");return s.addEventListener("keyup",a),c};