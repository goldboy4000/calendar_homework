!function(e){"use strict";var t,n=function(){t=new Calendar,t.init().render()},a=function(e){t&&(localStorage.removeItem("tasks"),localStorage.setItem("tasks",JSON.stringify(t)))};e.addEventListener("load",n),e.addEventListener("pagehide",a)}(window);
function Calendar(){var e=["ПН","ВТ","СР","ЧТ","ПТ","СБ","ВС"],t=[].shift.call(arguments)||(new Date).getMonth(),n=[].shift.call(arguments)||(new Date).getFullYear();this.__defineGetter__("month",function(){return t}),this.__defineGetter__("year",function(){return n}),this.chosenDay=(new Date).getDate();this.tasks=[],this.modal=new Modal(".modal");var a=function(){var e=document.createElement("div");return e.className="columns",e.appendChild(getColumn(getButton("previous","","fa fa-arrow-circle-o-left"))),e.appendChild(getColumn(getTag("date","title","is-primary","is-large",NAMES_OF_MONTHS[t]+" "+n),"is-three-quarters")),e.appendChild(getColumn(getButton("next","","fa fa-arrow-circle-o-right"))),e},r=function(){var t=document.createElement("thead"),n=document.createElement("tr");t.appendChild(n);for(var a=0;a<e.length;a++){var r=document.createElement("th");r.innerHTML=e[a],n.appendChild(r)}return t},i=function(){for(var e=document.createElement("tbody"),a=new Date(n,t),r=0===a.getDay()?7:a.getDay(),i=a.daysInMonth(),s=1,c=[],d=!0,o=0;o<a.fullWeeksInMonth();o++){c[o]=document.createElement("tr"),e.appendChild(c[o]);for(var l=1;l<=7;l++)column=document.createElement("td"),l<r&&d||s>i?column.innerHTML="&nbsp":(column.setAttribute("id","day"+s),column.innerHTML=s++,d=!1),c[o].appendChild(column)}return e},s=function(){var e=document.createElement("table");return e.className="table is-bordered",e.setAttribute("id","calendar"),e.appendChild(r()),e.appendChild(i()),e},c=function(){var e=document.createElement("ul");return e.setAttribute("class","task_list"),e};this.addTask=function(e){var a=new Date(n,t,this.chosenDay),r=new Task(e,a);this.tasks.push(r),this.render()},this.removeTask=function(e){this.tasks.forEach(function(t,n){t instanceof Task&&t.id===e&&(this.tasks.splice(n,1),this.render())}.bind(this))},this.init=function(){document.querySelector("#calendar_nav_container").addEventListener("click",calendarNavClickHandler.bind(this));var e=document.querySelector("#calendar_container");e.addEventListener("click",calendarClickHandler.bind(this)),e.addEventListener("success",modalSuccessHandler.bind(this));var t=localStorage.getItem("tasks");try{JSON.parse(t).forEach(function(e){var t=new Task(e.task,new Date(e.date));this.tasks.push(t)}.bind(this))}catch(e){this.tasks=[]}return this},this.render=function(){t=[].shift.call(arguments)||t,n=[].shift.call(arguments)||n;var e=document.querySelector("#calendar_nav_container");e.innerHTML="",e.appendChild(a());var r=document.querySelector("#calendar_container"),i=r.querySelector("#calendar");return i&&r.removeChild(i),r.appendChild(s()),this.tasks.forEach(function(e){if(e instanceof Task&&e.date.getMonth()===t){var n=r.querySelector("#day"+e.date.getDate()),a=n.querySelector(".task_list");a||(a=c(),n.insertBefore(a,n.childNodes[0])),a.appendChild(e.render())}}),this},this.previous=function(){return-1==--t&&(t=11,n--),this},this.next=function(){return 12==++t&&(t=0,n++),this},this.toJSON=function(){return this.tasks}}function calendarClickHandler(e){var t=e.target;if("delete"===t.id){var n=+t.closest(".task").id;return void(isNaN(n)||this.removeTask(n))}var a=t.closest("td");a&&(this.chosenDay=a.id.slice(3),this.modal.show("Event on "+this.chosenDay+" "+NAMES_OF_MONTHS[this.month]+" "+this.year))}function modalSuccessHandler(e){this.addTask(e.detail.message)}function calendarNavClickHandler(e){for(var t=e.target;"calendar_nav_container"!==t.id;){if("previous"===t.id){this.previous().render();break}if("next"===t.id){this.next().render();break}t=t.parentNode}}var NAMES_OF_MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"];
function Modal(t){this.modal=document.querySelector(t),this.init()}Modal.prototype.init=function(){this.modal.addEventListener("click",this.modalClickHandler.bind(this)),this.modal.addEventListener("keyup",this.modalKeyUpHandler.bind(this)),this.modal.querySelector("#success_button").disabled=!0},Modal.prototype.modalClickHandler=function(t){var e=t.target;if("success_button"===e.id){var i=new CustomEvent("success",{detail:{message:this.modal.querySelector("#text_input").value},bubbles:!0});this.modal.dispatchEvent(i),this.hide()}"cancel_button"!==e.id&&"close_button"!==e.id||this.hide()},Modal.prototype.modalKeyUpHandler=function(t){var e=t.target;"text_input"===e.id&&(this.modal.querySelector("#success_button").disabled=!e.value)},Modal.prototype.show=function(t){this.modal.querySelector("#title").innerHTML=t||"New Event",this.modal.classList.add("is-active")},Modal.prototype.hide=function(){this.modal.querySelector("#text_input").value="",this.modal.classList.remove("is-active"),this.modal.querySelector("#success_button").disabled=!0};
function Task(t,e){var n=t;this.__defineGetter__("task",function(){return n});var r=e;this.__defineGetter__("date",function(){return r});var i=this.generateId();this.__defineGetter__("id",function(){return i}),this.render=function(){var t=document.createElement("li");return t.appendChild(getTag(this.id,"task","is-primary","is-small",this.task,!0)),t}}Task.prototype.generateId=function(){var t=0;return function(){return t++}}();
var getOption=function(e,t){var n=document.createElement("option");return n.value=e,n.innerHTML=t,n},findChild=function(e,t){for(var n=0;n<e.children.length;n++)if(e.children[n].tagName===t.toUpperCase())return e.children[n];return null},getButton=function(e,t,n){var a=document.createElement("a"),r=document.createElement("span");r.className="icon is-large",r.setAttribute("id",e),a.appendChild(r);var l=document.createElement("i");return l.className=n,l.innerHTML=t,r.appendChild(l),a},getTag=function(e,t,n,a,r,l){var i=document.createElement("span");i.className="tag",i.classList.add(t),i.classList.add(n),i.classList.add(a),i.setAttribute("id",e);var d=document.createTextNode(r);if(i.appendChild(d),l){var o=document.createElement("button");o.className="delete is-small",o.setAttribute("id","delete"),i.appendChild(o)}return i},getColumn=function(e,t){var n=document.createElement("div");return n.className="column",t&&n.classList.add(t),n.appendChild(e),n};Date.prototype.daysInMonth=function(){return 32-new Date(this.getFullYear(),this.getMonth(),32).getDate()},Date.prototype.fullWeeksInMonth=function(){var e=new Date(this.getFullYear(),this.getMonth(),1).getDay();e=0===e?7:e;var t=e-1+this.daysInMonth();return Number(Math.floor(t/7)+Boolean(t%7))};