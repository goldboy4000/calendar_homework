var NAMES_OF_DAYS=["ПН","ВТ","СР","ЧТ","ПТ","СБ","ВС"],NAMES_OF_MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"];window.onload=function(){function e(e){l.render(a[a.selectedIndex].value,o[o.selectedIndex].value)}function t(){n.disabled=0===a.selectedIndex||0===o.selectedIndex}var n=document.getElementById("show_button");n.addEventListener("click",e),n.disabled=!0;var a=document.getElementById("month_selector");a.addEventListener("change",t),a.appendChild(getOption(-1,"-choose month-"));for(var r=0;r<NAMES_OF_MONTHS.length;r++)a.appendChild(getOption(r,NAMES_OF_MONTHS[r]));var o=document.getElementById("year_selector");o.addEventListener("change",t),o.appendChild(getOption(-1,"-choose year-"));for(var d=(new Date).getFullYear();d>=1900;d--)o.appendChild(getOption(d,d));var l=new Calendar;l.render()};var getOption=function(e,t){var n=document.createElement("option");return n.value=e,n.innerHTML=t,n};Date.prototype.daysInMonth=function(){return 32-new Date(this.getFullYear(),this.getMonth(),32).getDate()},Date.prototype.fullWeeksInMonth=function(){var e=new Date(this.getFullYear(),this.getMonth(),1).getDay();e=0===e?7:e;var t=e-1+this.daysInMonth();return Number(Math.floor(t/7)+Boolean(t%7))};
function Calendar(){var e=new Date;this.month=e.getMonth(),this.year=e.getFullYear()}Calendar.prototype.render=function(e,t){function n(e){var t=this;"previous"===t.id&&-1==--d.month&&(d.month=11,d.year--),"next"===t.id&&12==++d.month&&(d.month=0,d.year++),d.render(d.month,d.year)}function a(e){function t(e){var r,d=e.target,i=findChild(a,"ul");i?r=i:(r=document.createElement("ul"),a.insertBefore(r,a.childNodes[0]));var c=document.createElement("li");c.innerHTML=e.customParam,r.appendChild(c);var o=document.createElement("span");o.textContent=" [X] ",c.appendChild(o),d.removeEventListener("success",t),d.removeEventListener("cancel",n)}function n(e){var a=e.target;a.removeEventListener("success",t),a.removeEventListener("cancel",n)}var a=e.target;if(("TD"===a.tagName||"LI"===a.tagName)&&"&nbsp;"!==a.innerHTML){"LI"===a.tagName&&(a=a.parentNode.parentNode);var r=showModal("event_window","Event on "+a.id.slice(3)+" "+NAMES_OF_MONTHS[i]+" "+c);r.addEventListener("success",t),r.addEventListener("cancel",n)}if("SPAN"===a.tagName){var d=a.parentNode.parentNode;d.removeChild(a.parentNode),d.children.length||d.parentNode.removeChild(d)}}var r,d=this,i=e?this.month=e:this.month,c=t?this.year=t:this.year;(r=document.getElementById("calendar"))&&document.body.removeChild(r),r=document.createElement("table"),r.addEventListener("click",a),r.className="table is-bordered",r.setAttribute("id","calendar");var o=document.createElement("caption");o.innerHTML=NAMES_OF_MONTHS[i]+" "+c,r.appendChild(o);var l=document.createElement("a");o.appendChild(l),l.className="button is-primary",l.setAttribute("id","previous"),l.addEventListener("click",n);var m=document.createElement("span");l.appendChild(m),m.className="icon";var s=document.createElement("i");m.appendChild(s),s.className="fa fa-arrow-circle-o-left";var h=document.createElement("a");o.appendChild(h),h.className="button is-primary",h.setAttribute("id","next"),h.addEventListener("click",n),m=document.createElement("span"),h.appendChild(m),m.className="icon",s=document.createElement("i"),m.appendChild(s),s.className="fa fa-arrow-circle-o-right";var p=document.createElement("thead");r.appendChild(p);var u=document.createElement("tr");p.appendChild(u);for(var v=0;v<NAMES_OF_DAYS.length;v++){var E=document.createElement("th");E.innerHTML=NAMES_OF_DAYS[v],u.appendChild(E)}var N=document.createElement("tbody");r.appendChild(N);for(var C=new Date(c,i),f=0===C.getDay()?7:C.getDay(),g=C.daysInMonth(),y=1,L=[],M=!0,b=0;b<C.fullWeeksInMonth();b++){L[b]=document.createElement("tr"),N.appendChild(L[b]);for(var A=1;A<=7;A++)E=document.createElement("td"),A<f&&M||y>g?E.innerHTML="&nbsp":(E.setAttribute("id","day"+y),E.innerHTML=y++,M=!1),L[b].appendChild(E)}document.body.appendChild(r)};var findChild=function(e,t){for(var n=0;n<e.children.length;n++)if(e.children[n].tagName===t.toUpperCase())return e.children[n];return null};
var showModal=function(e,t){function n(e){var t=e.target;if("success_button"===t.id){this.classList.remove("is-active");var n=document.createEvent("Event");n.initEvent("success",!0,!0),n.customParam=s.value,c.dispatchEvent(n),s.value=""}if("cancel_button"===t.id||"close_button"===t.id){this.classList.remove("is-active"),s.value="";var a=document.createEvent("Event");a.initEvent("cancel",!0,!0),c.dispatchEvent(a)}}function a(e){var t=e.target;i.disabled=!t.value}var c=document.getElementById(e);c.classList.add("is-active"),c.addEventListener("click",n),document.getElementById("title").innerHTML=t;var i=document.getElementById("success_button");i.disabled=!0;var s=document.getElementById("event_text");return s.addEventListener("keyup",a),c};